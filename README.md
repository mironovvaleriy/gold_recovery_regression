## Описание проекта

Необходимо подготовить прототип модели машинного обучения. Модель должна предсказать коэффициент восстановления золота из золотосодержащей руды. Модель поможет оптимизировать производство, чтобы не запускать предприятие с убыточными характеристиками. Для работы представлены данные с параметрами добычи и очистки. 
Нужно спрогнозировать две величины:
* эффективность обогащения чернового концентрата `rougher.output.recovery`;
* эффективность обогащения финального концентрата `final.output.recovery`.

Предоставлено 3 датасета:
* gold_industry_train.csv — обучающая выборка;
* gold_industry_test.csv — тестовая выборка;
* gold_industry_full.csv — исходные данные (содержит в себе обучающую и тестовую выборки).

В качестве метрики качества используется sMAPE.

## Краткое описание техпроцесса

Процесс восстановления золота из руды содержит в себе 2 основные стадии:
1. Флотация.
Во флотационную установку подаётся смесь золотосодержащей руды. После обогащения получается черновой концентрат и «отвальные хвосты», то есть остатки продукта с низкой концентрацией ценных металлов.
2. Очистка. 
Черновой концентрат проходит две очистки. На выходе получается финальный концентрат и новые отвальные хвосты.

Модели прогнозируют эффективность обогащения концентрата после каждого из этапов.

## План работы

1. Импорт библиотек, первичный анализ данных
2. Предобработка данных: анализ и заполнение пропусков в строках и полях, поиск дубликатов, проверка правильности расчета коэффициента обогащения.
3. Анализ данных: анализ изменения концентрации металлов, размера гранул, суммарной концентрации металлов на разных этапах очистки, удаление выбросов.
4. Подготовка данных к ML алгоритмам: выделение целевого признака, создание оценщика.
5. Обучение моделей DecisionTree, RandomForest, LinearRegression.
6. Тестирование наилучшей модели на тестовой выборке, сравнение с константной моделью.

## Используемые библиотеки

* *pandas*
* *sklearn*
* *plotly*

## Итоги и выводы

По итогам работы были обучены и протестированы 2 модели рандомного леса, предсказывающие эффективность обогащения руды после этапа флотации и заверщающей очистки.

Для работы было представлено 3 датасета, содержащие информацию о параметрах добычи и очистки руды. Данные индексировались по дате и времени, это помогло заполнить имеющиеся пропуски, так как соседние объекты похожи по значениям. В процессе анализа данных было обнаружено, что тестовый датасет содержал меньшее количество полей по сравнению с тренировочным. После анализа отсутствующих полей выяснилось, что пропущенные данные измерялись во время и после технологического процесса, поэтому эти поля не были включены в обучающую выборку для моделей.

Был произведен анализ изменения концентрации металлов (Ag, Au, Pb) на различных этапах очистки. Графики представлены ниже. На них мы видим, что концентрация золота и свинца в основном продукте растет по мере прохождения очистки. Концентрация этих отвальных хвостах также растет до прохождения первого этапа основной очитки, на выходе концентрация уменьшается. Концентрация же серебра максимальна после прохождения флотации, дальше она снижается, также и для содержания серебра в отвальных хвостах.

![изменение au](<au_conc.png>)
![изменение ag](<ag_conc.png>)
![изменение pb](<pb_conc.png>)

После этого были изучены распределения размера гранул в обучающей и тестовой выборках. Видно, что распределения в обоих выборках схожи.

![feed_size](<feed_size.png>)

Также были изучены распределения суммарной концентрации веществ на этапах очистки. На графиках видно, что распределения суммарной концентрации на различных этапах приближаются к нормальным. Разница состоит в стандартном отклонении. На графиках видно, что после прохождения всех этапов очистки среднее отклонение концентрации меньше, чем до очистки. Выбросы, обнаруженные после анализа, были удалены.

![sum_conc](<sum_conc.png>)

После этого данные были подготовлены к использованию в алгоритмах. Были созданы 2 обучающие и 2 тестовые выборки для каждого из этапов. Также был создан оценщик для использования в кросс-валидации. Итоговый sMAPE рассчитывался на основе sMAPE каждого из этапов по формуле: `0.25*sMAPE_rougher_stage + 0.75*sMAPE_final_stage`.

Для каждого из алгоритмов (DecisionTree, RandomForest, LinearRegression) был написан отдельный класс, включающий в себя функцию обучения и получения итоговой метрики по кросс-валидации и функцию получения метрики на тестовой выборке.

В результате сравнения модели наилучшие результаты показала модель RandomForest, которая была протестирована на тестовой выборке. Итоговый sMAPE на тестовой выборке составил 9.36. Модель была сравнена с константной. Метрика константной модели равняется 9.45. Таким образом, наша модель показала лучшие результаты по сравнению с константной, хотя различие и не слишком большое.

Итоговую метрику можно улучшить с помощью более тщательного отбора используемых фич, а также с использованием градиентного бустинга.